#!/bin/bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•è„šæœ¬

set -e

echo "ğŸ§ª è¿è¡Œ Baresip æµ‹è¯•å¥—ä»¶..."
echo ""

# æ£€æŸ¥æ˜¯å¦å®‰è£…äº† xcodebuild
if ! command -v xcodebuild &> /dev/null; then
    echo "âŒ é”™è¯¯: æœªæ‰¾åˆ° xcodebuild"
    echo "   è¯·ç¡®ä¿å·²å®‰è£… Xcode Command Line Tools"
    exit 1
fi

# è¿è¡Œå•å…ƒæµ‹è¯•
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“‹ è¿è¡Œå•å…ƒæµ‹è¯•..."
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

# TODO: é…ç½® Xcode é¡¹ç›®åè¿è¡Œ
# xcodebuild test \
#     -scheme BaresipTests \
#     -destination 'platform=iOS Simulator,name=iPhone 14' \
#     -only-testing:BaresipTests/Unit

echo "âš ï¸  å•å…ƒæµ‹è¯•éœ€è¦ Xcode é¡¹ç›®é…ç½®"
echo ""

# è¿è¡Œé›†æˆæµ‹è¯•
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“‹ è¿è¡Œé›†æˆæµ‹è¯•..."
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

# TODO: é…ç½® Xcode é¡¹ç›®åè¿è¡Œ
# xcodebuild test \
#     -scheme BaresipTests \
#     -destination 'platform=iOS Simulator,name=iPhone 14' \
#     -only-testing:BaresipTests/Integration

echo "âš ï¸  é›†æˆæµ‹è¯•éœ€è¦ Xcode é¡¹ç›®é…ç½®å’ŒçœŸå® SIP æœåŠ¡å™¨"
echo ""

# è¿è¡Œæ€§èƒ½æµ‹è¯•
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“‹ è¿è¡Œæ€§èƒ½æµ‹è¯•..."
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

# TODO: ä½¿ç”¨ Xcode Instruments
echo "âš ï¸  æ€§èƒ½æµ‹è¯•éœ€è¦ä½¿ç”¨ Xcode Instruments"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ… æµ‹è¯•è„šæœ¬æ‰§è¡Œå®Œæˆ"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ“ æ³¨æ„äº‹é¡¹:"
echo "   1. å•å…ƒæµ‹è¯•éœ€è¦é…ç½® Xcode é¡¹ç›®"
echo "   2. é›†æˆæµ‹è¯•éœ€è¦çœŸå®çš„ SIP æœåŠ¡å™¨"
echo "   3. æ€§èƒ½æµ‹è¯•éœ€è¦ä½¿ç”¨ Xcode Instruments"
echo ""
